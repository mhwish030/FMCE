!function(e){"use strict";function t(e){this.init(e)}var n=document.createElement("x");n.style.cssText="pointer-events:none",n="none"===n.style.pointerEvents;var o="offset",s="mousemove",r="mouseout",i="pointerdown",a="touchstart",l="wheel";function u(e,t){return void 0===e[o+t]?e["layer"+t]-e.target[o+("X"===t?"Left":"Top")]:e[o+t]}function c(e){return parseInt(e,10)}function h(e,t,n){var o=e.className;n=n||"",e.className=(o.replace(n,"")+" "+t).replace(/^\s*([\S\s]*)\b\s*$/,"$1")}t.prototype={_:{},classes:{lens:"loupe",on:"loupe--active",off:"loupe--inactive"},on:!1,zoom:2,range:[1.2,7],init:function(e){var t=this;n&&(t._={},t.range=t.range.slice(0),t.el=e,t.render(),t.listen())},show:function(){this.on||(h(this.lens,this.classes.on,this.classes.off),this.on=!0)},hide:function(){h(this.lens,this.classes.off,this.classes.on),this.on=!1},render:function(){var e=this;e.lens=document.createElement("div"),e.lens.className+=" "+e.classes.lens,document.body.appendChild(e.lens)},image:function(e){var t,n=this;if(n._.l===e)return n._.s;n._.l=e;for(var o=e,s=[];o&&!t;)s.unshift(o),(o=o.parentNode)&&"A"===o.nodeName&&(t=o.href);return t||(t=e.src),n._.s=t,t},refresh:function(){var e=this,t=e.lens.style,n=arguments[0]||e._.e;if(n&&n.target&&(t.backgroundImage='url("'+e.image(n.target)+'")'),e._.e){var o=getComputedStyle(n.target),s=getComputedStyle(e.lens);e.show(),t.transform=t.webkitTransform="translate("+n.pageX+"px,"+n.pageY+"px)",e.lens.style.backgroundSize=c(o.width)*e.zoom+"px "+c(o.height)*e.zoom+"px",e.lens.style.backgroundPosition=0-u(n,"X")*e.zoom+c(s.width)/2+"px "+(0-u(n,"Y")*e.zoom+(c(s.height)/2|0))+"px"}e._.e=n},destroy:function(){var e=this,t=e.el.removeEventListener.bind(e.el);e.lens&&(e.lens.parentNode.removeChild(e.lens),e.lens=null),e._.mousemove&&(t(a,e._.touchstart),t(i,e._.pointerdown),t(s,e._.mousemove),t(r,e._.mouseout),t(l,e._.wheel)),e._={}},listen:function(){var e,t=this,n=t.el.addEventListener.bind(t.el);t._.touchstart=function(){e=!0},t._.pointerdown=function(t){"touch"===t.pointerType&&(e=!0)},t._.mousemove=function(n){e||t.refresh.call(t,n),e=!1},t._.mouseout=t.hide.bind(t),n(a,t._.touchstart),n(i,t._.pointerdown),n(s,t._.mousemove),n(r,t._.mouseout),t._.wheel=t.wheel.bind(t),n(l,t._.wheel)},wheel:function(e){var t,n=this;n.on&&(t=(t=n.zoom+.1*e.deltaY)<n.range[0]?n.range[0]:t>n.range[1]?n.range[1]:t,n.zoom=t,n.refresh(e),e.preventDefault())}},"function"==typeof define&&define.amd?define([],(function(){return t})):"object"==typeof module&&module.exports?module.exports=t:e.Loupe=t}(this);